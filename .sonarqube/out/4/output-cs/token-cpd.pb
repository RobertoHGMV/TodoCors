…
?C:\Projects\TodoCors\src\Todo.Infra\Contexts\TodoDataContext.cs
	namespace

 	
Todo


 
.

 
Infra

 
.

 
Contexts

 
{ 
public 

class 
TodoDataContext  
:! "
	DbContext# ,
{ 
public 
DbSet 
< 
User 
> 
Users  
{! "
get# &
;& '
set( +
;+ ,
}- .
	protected 
override 
void 
OnConfiguring  -
(- .#
DbContextOptionsBuilder. E
optionsBuilderF T
)T U
{ 	
if 
( 
! 
optionsBuilder 
.  
IsConfigured  ,
), -
optionsBuilder 
. 
	UseNpgsql (
(( )
ConnectionOptions) :
.: ;
GetInstance; F
(F G
)G H
.H I
ConnPostgresI U
)U V
;V W
} 	
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
builder= D
)D E
{ 	
builder 
. 
Ignore 
< 
Notification '
>' (
(( )
)) *
;* +
builder 
. 
Ignore 
< 
Name 
>  
(  !
)! "
;" #
builder 
. 
Ignore 
< 
Login  
>  !
(! "
)" #
;# $
builder 
. 
Ignore 
< 
Email  
>  !
(! "
)" #
;# $
builder 
. 
ApplyConfiguration &
(& '
new' *
UserMap+ 2
(2 3
)3 4
)4 5
;5 6
}   	
}!! 
}"" ô
7C:\Projects\TodoCors\src\Todo.Infra\Mappings\UserMap.cs
	namespace 	
Todo
 
. 
Infra 
. 
Mappings 
{ 
public 

class 
UserMap 
: $
IEntityTypeConfiguration 3
<3 4
User4 8
>8 9
{ 
public		 
void		 
	Configure		 
(		 
EntityTypeBuilder		 /
<		/ 0
User		0 4
>		4 5
builder		6 =
)		= >
{

 	
builder 
. 
ToTable 
( 
$str "
)" #
;# $
builder 
. 
HasKey 
( 
c 
=> 
c  !
.! "
Id" $
)$ %
;% &
builder 
. 
OwnsOne 
( 
c 
=>  
c! "
." #
Name# '
)' (
.( )
Property) 1
(1 2
l2 3
=>4 6
l7 8
.8 9
	FirstName9 B
)B C
.C D
HasMaxLengthD P
(P Q
$numQ S
)S T
.T U
HasColumnNameU b
(b c
$strc n
)n o
;o p
builder 
. 
OwnsOne 
( 
c 
=>  
c! "
." #
Name# '
)' (
.( )
Property) 1
(1 2
l2 3
=>4 6
l7 8
.8 9
LastName9 A
)A B
.B C
HasMaxLengthC O
(O P
$numP R
)R S
.S T
HasColumnNameT a
(a b
$strb l
)l m
;m n
builder 
. 
OwnsOne 
( 
c 
=>  
c! "
." #
Login# (
)( )
.) *
Property* 2
(2 3
l3 4
=>5 7
l8 9
.9 :
UserName: B
)B C
.C D
HasMaxLengthD P
(P Q
$numQ S
)S T
.T U
HasColumnNameU b
(b c
$strc m
)m n
;n o
builder 
. 
OwnsOne 
( 
c 
=>  
c! "
." #
Login# (
)( )
.) *
Property* 2
(2 3
l3 4
=>5 7
l8 9
.9 :
Password: B
)B C
.C D
HasMaxLengthD P
(P Q
$numQ S
)S T
.T U
IsFixedLengthU b
(b c
)c d
.d e
HasColumnNamee r
(r s
$strs }
)} ~
;~ 
builder 
. 
OwnsOne 
( 
c 
=>  
c! "
." #
Login# (
)( )
.) *
Ignore* 0
(0 1
l1 2
=>3 5
l6 7
.7 8
ConfirmPassword8 G
)G H
;H I
builder 
. 
OwnsOne 
( 
c 
=>  
c! "
." #
Email# (
)( )
.) *
Property* 2
(2 3
e3 4
=>5 7
e8 9
.9 :
Address: A
)A B
.B C
HasMaxLengthC O
(O P
$numP S
)S T
.T U
HasColumnNameU b
(b c
$strc l
)l m
;m n
} 	
} 
} è
BC:\Projects\TodoCors\src\Todo.Infra\Repositories\UserRepository.cs
	namespace		 	
Todo		
 
.		 
Infra		 
.		 
Repositories		 !
{

 
public 

class 
UserRepository 
:  !
IUserRepository" 1
{ 
readonly 
TodoDataContext  
_context! )
;) *
public 
UserRepository 
( 
TodoDataContext -
context. 5
)5 6
{ 	
_context 
= 
context 
; 
} 	
public 
IList 
< 
User 
> 
GetAll !
(! "
)" #
{ 	
return 
_context 
. 
Users !
.! "
AsNoTracking" .
(. /
)/ 0
.0 1
ToList1 7
(7 8
)8 9
;9 :
} 	
public 
User 
GetByUserName !
(! "
string" (
userName) 1
)1 2
{ 	
return 
_context 
. 
Users !
.! "
AsNoTracking" .
(. /
)/ 0
.0 1
FirstOrDefault1 ?
(? @
	UserQuery@ I
.I J
GetByUserNameJ W
(W X
userNameX `
)` a
)a b
;b c
} 	
public 
void 
Add 
( 
User 
user !
)! "
{ 	
_context   
.   
Users   
.   
Add   
(   
user   #
)  # $
;  $ %
}!! 	
public## 
void## 
Update## 
(## 
User## 
user##  $
)##$ %
{$$ 	
_context%% 
.%% 
Entry%% 
(%% 
user%% 
)%%  
.%%  !
State%%! &
=%%' (
EntityState%%) 4
.%%4 5
Modified%%5 =
;%%= >
}&& 	
public(( 
void(( 
Remove(( 
((( 
User(( 
user((  $
)(($ %
{)) 	
_context** 
.** 
Users** 
.** 
Remove** !
(**! "
user**" &
)**& '
;**' (
}++ 	
},, 
}-- —
7C:\Projects\TodoCors\src\Todo.Infra\Transactions\Uow.cs
	namespace 	
Todo
 
. 
Infra 
. 
Transactions !
{ 
public 

class 
Uow 
: 
IUow 
{ 
readonly 
TodoDataContext  
_context! )
;) *
public

 
Uow

 
(

 
TodoDataContext

 "
context

# *
)

* +
{ 	
_context 
= 
context 
; 
} 	
public 
void 
Commit 
( 
) 
{ 	
_context 
. 
SaveChanges  
(  !
)! "
;" #
} 	
} 
} 