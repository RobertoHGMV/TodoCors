ÎF
?C:\Projects\TodoCors\src\Todo.Api\Controllers\UserController.cs
	namespace		 	
Todo		
 
.		 
Api		 
.		 
Controllers		 
{

 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
UserController 
:  !

Controller" ,
{ 
readonly 
IUserRepository  
_repository! ,
;, -
readonly 
UserHandler 
_handler %
;% &
public 
UserController 
( 
IUserRepository -

repository. 8
,8 9
UserHandler: E
handlerF M
)M N
{ 	
_repository 
= 

repository $
;$ %
_handler 
= 
handler 
; 
} 	
[ 	
HttpGet	 
] 
[ 	
Route	 
( 
$str  
)  !
]! "
public 
IActionResult 
GetAll #
(# $
)$ %
{ 	
try 
{ 
var 
users 
= 
_repository '
.' (
GetAll( .
(. /
)/ 0
;0 1
var   
result   
=   
new    
List  ! %
<  % & 
GetUserCommandResult  & :
>  : ;
(  ; <
)  < =
;  = >
foreach"" 
("" 
var"" 
user"" !
in""" $
users""% *
)""* +
result## 
.## 
Add## 
(## 
new## " 
GetUserCommandResult### 7
(##7 8
user##8 <
.##< =
Name##= A
.##A B
	FirstName##B K
,##K L
user##M Q
.##Q R
Name##R V
.##V W
LastName##W _
,##_ `
user##a e
.##e f
Login##f k
.##k l
UserName##l t
,##t u
user##v z
.##z {
Email	##{ €
.
##€ 
Address
## ˆ
)
##ˆ ‰
)
##‰ Š
;
##Š ‹
return%% 
Ok%% 
(%% 
new%%  
GenericCommandResult%% 2
(%%2 3
true%%3 7
,%%7 8
$str%%9 Y
,%%Y Z
result%%[ a
)%%a b
)%%b c
;%%c d
}&& 
catch'' 
('' 
	Exception'' 
ex'' 
)''  
{(( 
return)) 

BadRequest)) !
())! "
new))" % 
GenericCommandResult))& :
()): ;
false)); @
,))@ A
$str))B Z
,))Z [
ex))\ ^
)))^ _
)))_ `
;))` a
}** 
}++ 	
[-- 	
HttpGet--	 
]-- 
[.. 	
Route..	 
(.. 
$str.. +
)..+ ,
].., -
public// 
IActionResult// 
Get//  
(//  !
string//! '
username//( 0
)//0 1
{00 	
try11 
{22 
var33 
user33 
=33 
_repository33 &
.33& '
GetByUserName33' 4
(334 5
username335 =
)33= >
;33> ?
if55 
(55 
user55 
is55 
null55  
)55  !
return66 

BadRequest66 %
(66% &
new66& ) 
GenericCommandResult66* >
(66> ?
false66? D
,66D E
$str66F ^
,66^ _
null66` d
)66d e
)66e f
;66f g
var88 
result88 
=88 
new88   
GetUserCommandResult88! 5
(885 6
user886 :
.88: ;
Name88; ?
.88? @
	FirstName88@ I
,88I J
user88K O
.88O P
Name88P T
.88T U
LastName88U ]
,88] ^
user88_ c
.88c d
Login88d i
.88i j
UserName88j r
,88r s
user88t x
.88x y
Email88y ~
.88~ 
Address	88 †
)
88† ‡
;
88‡ ˆ
return:: 
Ok:: 
(:: 
result::  
)::  !
;::! "
};; 
catch<< 
(<< 
	Exception<< 
ex<< 
)<<  
{== 
return>> 

BadRequest>> !
(>>! "
new>>" % 
GenericCommandResult>>& :
(>>: ;
false>>; @
,>>@ A
$str>>B Z
,>>Z [
ex>>\ ^
)>>^ _
)>>_ `
;>>` a
}?? 
}@@ 	
[BB 	
HttpPostBB	 
]BB 
[CC 	
RouteCC	 
(CC 
$strCC  
)CC  !
]CC! "
publicDD 
IActionResultDD 
AddDD  
(DD  !
[DD! "
FromBodyDD" *
]DD* +
CreateUserCommandDD, =
commandDD> E
)DDE F
{EE 	
tryFF 
{GG 
varHH 
resultHH 
=HH 
_handlerHH %
.HH% &
HandleHH& ,
(HH, -
commandHH- 4
)HH4 5
asHH6 8 
GenericCommandResultHH9 M
;HHM N
ifJJ 
(JJ 
!JJ 
resultJJ 
.JJ 
SuccessJJ #
)JJ# $
returnJJ% +

BadRequestJJ, 6
(JJ6 7
resultJJ7 =
)JJ= >
;JJ> ?
returnLL 
CreatedLL 
(LL 
$strLL !
,LL! "
resultLL# )
)LL) *
;LL* +
}MM 
catchNN 
(NN 
	ExceptionNN 
exNN 
)NN  
{OO 
returnPP 

BadRequestPP !
(PP! "
newPP" % 
GenericCommandResultPP& :
(PP: ;
falsePP; @
,PP@ A
$strPPB Z
,PPZ [
exPP\ ^
)PP^ _
)PP_ `
;PP` a
}QQ 
}RR 	
[TT 	
HttpPutTT	 
]TT 
[UU 	
RouteUU	 
(UU 
$strUU  
)UU  !
]UU! "
publicVV 
IActionResultVV 
UpdateVV #
(VV# $
[VV$ %
FromBodyVV% -
]VV- .
UpdateUserCommandVV/ @
commandVVA H
)VVH I
{WW 	
tryXX 
{YY 
varZZ 
resultZZ 
=ZZ 
_handlerZZ %
.ZZ% &
HandleZZ& ,
(ZZ, -
commandZZ- 4
)ZZ4 5
asZZ6 8 
GenericCommandResultZZ9 M
;ZZM N
if\\ 
(\\ 
!\\ 
result\\ 
.\\ 
Success\\ #
)\\# $
return\\% +

BadRequest\\, 6
(\\6 7
result\\7 =
)\\= >
;\\> ?
return^^ 
Ok^^ 
(^^ 
result^^  
)^^  !
;^^! "
}__ 
catch`` 
(`` 
	Exception`` 
ex`` 
)``  
{aa 
returnbb 

BadRequestbb !
(bb! "
newbb" % 
GenericCommandResultbb& :
(bb: ;
falsebb; @
,bb@ A
$strbbB Z
,bbZ [
exbb\ ^
)bb^ _
)bb_ `
;bb` a
}cc 
}dd 	
[ff 	

HttpDeleteff	 
]ff 
[gg 	
Routegg	 
(gg 
$strgg  
)gg  !
]gg! "
publichh 
IActionResulthh 
Deletehh #
(hh# $
[hh$ %
FromBodyhh% -
]hh- .
DeleteUserCommandhh/ @
commandhhA H
)hhH I
{ii 	
tryjj 
{kk 
varll 
resultll 
=ll 
_handlerll %
.ll% &
Handlell& ,
(ll, -
commandll- 4
)ll4 5
asll6 8 
GenericCommandResultll9 M
;llM N
ifnn 
(nn 
!nn 
resultnn 
.nn 
Successnn #
)nn# $
returnnn% +

BadRequestnn, 6
(nn6 7
resultnn7 =
)nn= >
;nn> ?
returnpp 
	NoContentpp  
(pp  !
)pp! "
;pp" #
}qq 
catchrr 
(rr 
	Exceptionrr 
exrr 
)rr  
{ss 
returntt 

BadRequesttt !
(tt! "
newtt" % 
GenericCommandResulttt& :
(tt: ;
falsett; @
,tt@ A
$strttB Z
,ttZ [
extt\ ^
)tt^ _
)tt_ `
;tt` a
}uu 
}vv 	
}ww 
}xx ²

,C:\Projects\TodoCors\src\Todo.Api\Program.cs
	namespace

 	
Todo


 
.

 
Api

 
{ 
public 

static 
class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} °*
,C:\Projects\TodoCors\src\Todo.Api\Startup.cs
	namespace 	
Todo
 
. 
Api 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
private 
ConnectionOptions !
_connOptions" .
;. /
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
_connOptions 
= 
new 
ConnectionOptions 0
(0 1
Configuration1 >
.> ?
GetConnectionString? R
(R S
ConnectionOptionsS d
.d e

FieldsNamee o
.o p
ConnPostgresp |
)| }
)} ~
;~ 
services 
. 
AddCors 
( 
) 
; 
services 
. 
AddControllers #
(# $
)$ %
;% &
services 
. 
AddSwaggerGen "
(" #
c# $
=>% '
{   
c!! 
.!! 

SwaggerDoc!! 
(!! 
$str!! !
,!!! "
new!!# &
OpenApiInfo!!' 2
{!!3 4
Title!!5 :
=!!; <
$str!!= S
,!!S T
Version!!U \
=!!] ^
$str!!_ c
}!!d e
)!!e f
;!!f g
}"" 
)"" 
;"" 
new$$ 
DependencyResolver$$ "
($$" #
)$$# $
.$$$ %
Resolver$$% -
($$- .
services$$. 6
)$$6 7
;$$7 8#
ConfigureFluentMigrator%% #
(%%# $
services%%$ ,
)%%, -
;%%- .
}&& 	
public)) 
void)) 
	Configure)) 
()) 
IApplicationBuilder)) 1
app))2 5
,))5 6
IWebHostEnvironment))7 J
env))K N
,))N O
IMigrationRunner))P `
migrationRunner))a p
)))p q
{** 	
if++ 
(++ 
env++ 
.++ 
IsDevelopment++ !
(++! "
)++" #
)++# $
{,, 
app-- 
.-- %
UseDeveloperExceptionPage-- -
(--- .
)--. /
;--/ 0
app.. 
... 

UseSwagger.. 
(.. 
)..  
;..  !
app// 
.// 
UseSwaggerUI//  
(//  !
c//! "
=>//# %
{00 
c11 
.11 
SwaggerEndpoint11 %
(11% &
$str11& @
,11@ A
$str11B ^
)11^ _
;11_ `
}22 
)22 
;22 
}33 
app55 
.55 
UseHttpsRedirection55 #
(55# $
)55$ %
;55% &
app66 
.66 

UseRouting66 
(66 
)66 
;66 
app88 
.88 
UseCors88 
(88 
x99 
=>99 
x99 
.:: 
AllowAnyOrigin:: 
(::  
)::  !
.;; 
AllowAnyMethod;; 
(;;  
);;  !
.<< 
AllowAnyHeader<< 
(<<  
)<<  !
)<<! "
;<<" #
app>> 
.>> 
UseAuthorization>>  
(>>  !
)>>! "
;>>" #
app@@ 
.@@ 
UseEndpoints@@ 
(@@ 
	endpoints@@ &
=>@@' )
{AA 
	endpointsBB 
.BB 
MapControllersBB (
(BB( )
)BB) *
;BB* +
}CC 
)CC 
;CC 
migrationRunnerEE 
.EE 
	MigrateUpEE %
(EE% &
)EE& '
;EE' (
}FF 	
privateHH 
voidHH #
ConfigureFluentMigratorHH ,
(HH, -
IServiceCollectionHH- ?
servicesHH@ H
)HHH I
{II 	
servicesJJ 
.JJ !
AddFluentMigratorCoreJJ *
(JJ* +
)JJ+ ,
.KK 
ConfigureRunnerKK  
(KK  !
builderLL 
=>LL 
builderLL "
.MM 
WithVersionTableMM !
(MM! "
newMM" %!
TableVersionMigrationMM& ;
(MM; <
)MM< =
)MM= >
.NN 
AddPostgresNN 
(NN 
)NN 
.OO &
WithGlobalConnectionStringOO +
(OO+ ,
_connOptionsOO, 8
.OO8 9
ConnPostgresOO9 E
)OOE F
.PP 
ScanInPP 
(PP 
typeofPP 
(PP !
TableVersionMigrationPP 4
)PP4 5
.PP5 6
AssemblyPP6 >
)PP> ?
.PP? @
ForPP@ C
.PPC D

MigrationsPPD N
(PPN O
)PPO P
)PPP Q
;PPQ R
}QQ 	
}RR 
}SS 